scripted_gui = {
	dh_open_war_room_window = {
		context_type = player_context

		window_name = "dh_open_war_room_window"
		parent_window_token = top_bar

		visible = {
			is_ai = no
		}

		effects = {
			open_button_click = {
				set_variable = { show_war_room_window = 1 }
				if = {
					limit = {
						set_temp_variable = { amount = 1 }
						has_amount_of_active_war_room_operations = yes
					}
					set_temp_variable = { operation_id = 1 }
					custom_effect_tooltip = DH_WAR_ROOM_OPERATION_ACTIVE_OPERATIONS_LIST_TT
					if = {
						limit = {
							set_temp_variable = { amount = 2 }
							has_amount_of_active_war_room_operations = yes
						}
						set_temp_variable = { operation_id = 2 }
						custom_effect_tooltip = DH_WAR_ROOM_OPERATION_ACTIVE_OPERATIONS_LIST_TT
						if = {
							limit = {
								set_temp_variable = { amount = 3 }
								has_amount_of_active_war_room_operations = yes
							}
							set_temp_variable = { operation_id = 3 }
							custom_effect_tooltip = DH_WAR_ROOM_OPERATION_ACTIVE_OPERATIONS_LIST_TT
							if = {
								limit = {
									set_temp_variable = { amount = 4 }
									has_amount_of_active_war_room_operations = yes
								}
								set_temp_variable = { operation_id = 4 }
								custom_effect_tooltip = DH_WAR_ROOM_OPERATION_ACTIVE_OPERATIONS_LIST_TT
								if = {
									limit = {
										set_temp_variable = { amount = 5 }
										has_amount_of_active_war_room_operations = yes
									}
									set_temp_variable = { operation_id = 5 }
									custom_effect_tooltip = DH_WAR_ROOM_OPERATION_ACTIVE_OPERATIONS_LIST_TT
									if = {
										limit = {
											set_temp_variable = { amount = 6 }
											has_amount_of_active_war_room_operations = yes
										}
										custom_effect_tooltip = DH_WAR_ROOM_OPERATION_ACTIVE_OPERATIONS_LIST_TT_MORE
									}
								}
							}
						}
					}
				}
			}
			close_button_click = {
				clear_variable = show_war_room_window
			}
		}

		triggers = {
			open_button_visible = {
				NOT = { has_variable = show_war_room_window }
			}
			open_button_click_enabled = {
				set_temp_variable = { amount = 1 }
				has_amount_of_possible_war_room_operations = yes
			}
			close_button_visible = {
				has_variable = show_war_room_window
			}
			value_bg_visible = {
				set_temp_variable = { amount = 1 }
				has_amount_of_active_war_room_operations = yes
			}
			value_visible = {
				set_temp_variable = { amount = 1 }
				has_amount_of_active_war_room_operations = yes
			}
		}

		properties = {
			open_button = {
				x = global.dh_war_room_top_bar_button_position
			}
			close_button = {
				x = global.dh_war_room_top_bar_button_position
			}
			value_bg = {
				x = global.dh_war_room_top_bar_button_position
			}
			value = {
				x = global.dh_war_room_top_bar_button_position
			}
		}

		ai_enabled = {
			always = no
		}
	}

	dh_war_room_window = {
		context_type = player_context

		window_name = "dh_war_room_window"

		dirty = show_war_room_window

		visible = {
			has_variable = show_war_room_window
		}

		effects = {
			close_button_click = {
				clear_variable = show_dh_war_room_assign_generals_window
				clear_variable = show_war_room_window
			}
			# Active Operations:
			## expand/collapse buttons
			active_operation_expand_button_click = {
				clear_variable = show_dh_war_room_assign_generals_window
				set_temp_variable = { operation_id = v }
				expand_war_room_operation_tab = yes
			}
			active_operation_collapse_button_click = {
				clear_variable = show_dh_war_room_assign_generals_window
				set_temp_variable = { operation_id = v }
				collapse_war_room_operation_tab = yes
			}
			## get tooltips for effects
			active_operation_complete_conditions_and_effects_click = {
				# just used for tooltips
				set_temp_variable = { operation_id = v }
				set_temp_variable = { no_tooltip = 1 }
				effect_tooltip = {
					complete_war_room_operation = yes
				}
			}
			active_operation_fail_conditions_and_effects_click = {
				# just used for tooltips
				set_temp_variable = { operation_id = v }
				set_temp_variable = { no_tooltip = 1 }
				effect_tooltip = {
					fail_war_room_operation = yes
				}
			}
			## generals
			active_operation_assign_general_button_click = {
				set_temp_variable = { operation_id = v }
				set_variable = { show_dh_war_room_assign_generals_window = operation_id }
				update_war_room_window = yes
			}
			## tabs
			active_operation_tab_button_description_click = {
				set_temp_variable = { operation_id = v }
				deselect_decisions_tab_for_war_room_operation = yes
			}
			active_operation_tab_button_decisions_click = {
				set_temp_variable = { operation_id = v }
				select_decisions_tab_for_war_room_operation = yes
			}
			## decisions
			decision_name_click = {
				set_temp_variable = { decision_id = decision_v }
				meta_effect = {
					text = {
						custom_effect_tooltip = [ID]_desc
					}
					ID = "[?decision_id.GetTokenKey]"
				}
			}
			decision_button_click = {
				clear_variable = show_dh_war_room_assign_generals_window
				set_temp_variable = { operation_id = v }
				set_temp_variable = { decision_id = decision_v }
				hidden_effect = {
					meta_effect = {
						text = {
							activate_decision = [ID]
						}
						ID = "[?decision_id.GetTokenKey]"
					}
				}
				set_temp_variable = { show_tooltip = 1 }
				set_temp_variable = { no_tooltip = 0 }
				effect_tooltip = {
					if = {
						limit = {
							NOT = { is_war_room_operation_decision_in_progress = yes }
						}
						execute_complete_effect_war_room_operation_decision = yes
					}
					execute_remove_effect_war_room_operation_decision = yes
					execute_cancel_effect_war_room_operation_decision = yes
				}
			}
			## progressbar
			active_operation_progressbar_indicator_click = {
				# get tooltip for current phase
				set_temp_variable = { operation_id = v }
				if = {
					limit = {
						OR = {
							has_war_room_operation_progress_phase_1 = yes
							has_war_room_operation_progress_phase_2 = yes
							has_war_room_operation_progress_phase_3 = yes
							has_war_room_operation_progress_phase_4 = yes
							has_war_room_operation_progress_phase_5 = yes
						}
					}
					if = {
						limit = {
							has_war_room_operation_progress_phase_5 = yes
							is_war_room_operation_progress_phase_5_active = yes
						}
						custom_effect_tooltip = DH_WAR_ROOM_OPERATION_ACTIVE_ENTRY_PROGRESS_BAR_CURRENT_PHASE_TT_5
						effect_tooltip = {
							execute_war_room_operation_progress_phase_5_effect = yes
						}
					}
					else_if = {
						limit = {
							has_war_room_operation_progress_phase_4 = yes
							is_war_room_operation_progress_phase_4_active = yes
						}
						custom_effect_tooltip = DH_WAR_ROOM_OPERATION_ACTIVE_ENTRY_PROGRESS_BAR_CURRENT_PHASE_TT_4
						effect_tooltip = {
							execute_war_room_operation_progress_phase_4_effect = yes
						}
					}
					else_if = {
						limit = {
							has_war_room_operation_progress_phase_3 = yes
							is_war_room_operation_progress_phase_3_active = yes
						}
						custom_effect_tooltip = DH_WAR_ROOM_OPERATION_ACTIVE_ENTRY_PROGRESS_BAR_CURRENT_PHASE_TT_3
						effect_tooltip = {
							execute_war_room_operation_progress_phase_3_effect = yes
						}
					}
					else_if = {
						limit = {
							has_war_room_operation_progress_phase_2 = yes
							is_war_room_operation_progress_phase_2_active = yes
						}
						custom_effect_tooltip = DH_WAR_ROOM_OPERATION_ACTIVE_ENTRY_PROGRESS_BAR_CURRENT_PHASE_TT_2
						effect_tooltip = {
							execute_war_room_operation_progress_phase_2_effect = yes
						}
					}
					else_if = {
						limit = {
							has_war_room_operation_progress_phase_1 = yes
							is_war_room_operation_progress_phase_1_active = yes
						}
						custom_effect_tooltip = DH_WAR_ROOM_OPERATION_ACTIVE_ENTRY_PROGRESS_BAR_CURRENT_PHASE_TT_1
						effect_tooltip = {
							execute_war_room_operation_progress_phase_1_effect = yes
						}
						custom_effect_tooltip = DH_WAR_ROOM_OPERATION_CAN_BE_STARTED_TT
					}
					else = {
						custom_effect_tooltip = DH_WAR_ROOM_OPERATION_ACTIVE_ENTRY_PROGRESS_BAR_CURRENT_PHASE_TT_NONE
					}
				}
			}
			active_operation_phase_icon_1_click = {
				# get tooltip for current phase
				set_temp_variable = { operation_id = v }
				if = {
					limit = {
						is_war_room_operation_progress_phase_1_active = yes
					}
					custom_effect_tooltip = DH_WAR_ROOM_OPERATION_ACTIVE_ENTRY_PROGRESS_BAR_PHASE_1_TT_ACTIVE
				}
				else = {
					custom_effect_tooltip = DH_WAR_ROOM_OPERATION_ACTIVE_ENTRY_PROGRESS_BAR_PHASE_1_TT_INACTIVE
				}
				effect_tooltip = {
					execute_war_room_operation_progress_phase_1_effect = yes
				}
				custom_effect_tooltip = DH_WAR_ROOM_OPERATION_CAN_BE_STARTED_TT
			}
			active_operation_phase_icon_2_click = {
				# get tooltip for current phase
				set_temp_variable = { operation_id = v }
				if = {
					limit = {
						is_war_room_operation_progress_phase_2_active = yes
					}
					custom_effect_tooltip = DH_WAR_ROOM_OPERATION_ACTIVE_ENTRY_PROGRESS_BAR_PHASE_2_TT_ACTIVE
				}
				else = {
					custom_effect_tooltip = DH_WAR_ROOM_OPERATION_ACTIVE_ENTRY_PROGRESS_BAR_PHASE_2_TT_INACTIVE
				}
				effect_tooltip = {
					execute_war_room_operation_progress_phase_2_effect = yes
				}
			}
			active_operation_phase_icon_3_click = {
				# get tooltip for current phase
				set_temp_variable = { operation_id = v }
				if = {
					limit = {
						is_war_room_operation_progress_phase_3_active = yes
					}
					custom_effect_tooltip = DH_WAR_ROOM_OPERATION_ACTIVE_ENTRY_PROGRESS_BAR_PHASE_3_TT_ACTIVE
				}
				else = {
					custom_effect_tooltip = DH_WAR_ROOM_OPERATION_ACTIVE_ENTRY_PROGRESS_BAR_PHASE_3_TT_INACTIVE
				}
				effect_tooltip = {
					execute_war_room_operation_progress_phase_3_effect = yes
				}
			}
			active_operation_phase_icon_4_click = {
				# get tooltip for current phase
				set_temp_variable = { operation_id = v }
				if = {
					limit = {
						is_war_room_operation_progress_phase_4_active = yes
					}
					custom_effect_tooltip = DH_WAR_ROOM_OPERATION_ACTIVE_ENTRY_PROGRESS_BAR_PHASE_4_TT_ACTIVE
				}
				else = {
					custom_effect_tooltip = DH_WAR_ROOM_OPERATION_ACTIVE_ENTRY_PROGRESS_BAR_PHASE_4_TT_INACTIVE
				}
				effect_tooltip = {
					execute_war_room_operation_progress_phase_4_effect = yes
				}
			}
			active_operation_phase_icon_5_click = {
				# get tooltip for current phase
				set_temp_variable = { operation_id = v }
				if = {
					limit = {
						is_war_room_operation_progress_phase_5_active = yes
					}
					custom_effect_tooltip = DH_WAR_ROOM_OPERATION_ACTIVE_ENTRY_PROGRESS_BAR_PHASE_5_TT_ACTIVE
				}
				else = {
					custom_effect_tooltip = DH_WAR_ROOM_OPERATION_ACTIVE_ENTRY_PROGRESS_BAR_PHASE_5_TT_INACTIVE
				}
				effect_tooltip = {
					execute_war_room_operation_progress_phase_5_effect = yes
				}
			}
		}

		triggers = {
			# Possible Operations:
			operation_icon_visible = {
				set_temp_variable = { operation_id = v }
				if = {
					limit = {
						has_active_war_room_operation = yes
					}
					set_temp_variable = { operation_icon_frame = 1 }
				}
				else_if = {
					limit = {
						has_completed_war_room_operation = yes
					}
					set_temp_variable = { operation_icon_frame = 3 }
				}
				else_if = {
					limit = {
						has_failed_war_room_operation = yes
					}
					set_temp_variable = { operation_icon_frame = 4 }
				}
				else = {
					set_temp_variable = { operation_icon_frame = 2 }
				}
			}
			operation_name_visible = {
				set_temp_variable = { operation_id = v }
				OR = {
					has_active_war_room_operation = yes
					has_completed_war_room_operation = yes
				}
			}
			operation_name_failed_visible = {
				set_temp_variable = { operation_id = v }
				has_failed_war_room_operation = yes
			}
			# Active Operations:
			## get tooltips for conditions
			active_operation_complete_conditions_and_effects_visible = {
				set_temp_variable = { operation_id = v }
				can_complete_war_room_operation = yes
				hidden_trigger = {
					always = no # just used for tooltips
				}
			}
			active_operation_fail_conditions_and_effects_visible = {
				set_temp_variable = { operation_id = v }
				can_fail_war_room_operation = yes
				hidden_trigger = {
					always = no # just used for tooltips
				}
			}
			## progress text when collapsed
			active_operation_collapsed_progress_text_bg_visible = {
				set_temp_variable = { operation_id = v }
				has_not_launched_war_room_operation = yes
			}
			active_operation_collapsed_progress_text_visible = {
				set_temp_variable = { operation_id = v }
				has_not_launched_war_room_operation = yes
				calculate_war_room_operation_progress = yes
			}
			## launched stamp
			active_operation_launched_stamp_icon_visible = {
				set_temp_variable = { operation_id = v }
				has_launched_war_room_operation = yes
			}
			## generals
			active_operation_assign_general_button_click_enabled = {
				set_temp_variable = { active_operation_assign_general_button_frame = 2 }
				set_temp_variable = { operation_id = v }
				has_not_launched_war_room_operation = yes
				set_temp_variable = { amount = 4 }
				has_less_amount_of_war_room_operation_assigned_generals = yes
				set_temp_variable = { active_operation_assign_general_button_frame = 1 }
			}
			active_operation_assigned_general_1_bg_visible = {
				set_temp_variable = { operation_id = v }
				set_temp_variable = { amount = 1 }
				if = {
					limit = {
						has_amount_of_war_room_operation_used_generals = yes
						has_amount_of_war_room_operation_assigned_generals = yes
					}
					set_temp_variable = { active_operation_assigned_general_1_bg_frame = 2 }
				}
				else = {
					set_temp_variable = { active_operation_assigned_general_1_bg_frame = 1 }
				}
			}
			active_operation_assigned_general_1_name_visible = {
				set_temp_variable = { operation_id = v }
				set_temp_variable = { amount = 1 }
				OR = {
					has_less_amount_of_war_room_operation_used_generals = yes
					has_less_amount_of_war_room_operation_assigned_generals = yes
				}
			}
			active_operation_assigned_general_1_name_red_visible = {
				set_temp_variable = { operation_id = v }
				set_temp_variable = { amount = 1 }
				has_amount_of_war_room_operation_used_generals = yes
				has_amount_of_war_room_operation_assigned_generals = yes
			}
			active_operation_assigned_general_2_bg_visible = {
				set_temp_variable = { operation_id = v }
				set_temp_variable = { amount = 2 }
				if = {
					limit = {
						has_amount_of_war_room_operation_used_generals = yes
						has_amount_of_war_room_operation_assigned_generals = yes
					}
					set_temp_variable = { active_operation_assigned_general_1_bg_frame = 2 }
				}
				else = {
					set_temp_variable = { active_operation_assigned_general_1_bg_frame = 1 }
				}
			}
			active_operation_assigned_general_2_name_visible = {
				set_temp_variable = { operation_id = v }
				set_temp_variable = { amount = 2 }
				OR = {
					has_less_amount_of_war_room_operation_used_generals = yes
					has_less_amount_of_war_room_operation_assigned_generals = yes
				}
			}
			active_operation_assigned_general_2_name_red_visible = {
				set_temp_variable = { operation_id = v }
				set_temp_variable = { amount = 2 }
				has_amount_of_war_room_operation_used_generals = yes
				has_amount_of_war_room_operation_assigned_generals = yes
			}
			active_operation_assigned_general_3_bg_visible = {
				set_temp_variable = { operation_id = v }
				set_temp_variable = { amount = 3 }
				if = {
					limit = {
						has_amount_of_war_room_operation_used_generals = yes
						has_amount_of_war_room_operation_assigned_generals = yes
					}
					set_temp_variable = { active_operation_assigned_general_1_bg_frame = 2 }
				}
				else = {
					set_temp_variable = { active_operation_assigned_general_1_bg_frame = 1 }
				}
			}
			active_operation_assigned_general_3_name_visible = {
				set_temp_variable = { operation_id = v }
				set_temp_variable = { amount = 3 }
				OR = {
					has_less_amount_of_war_room_operation_used_generals = yes
					has_less_amount_of_war_room_operation_assigned_generals = yes
				}
			}
			active_operation_assigned_general_3_name_red_visible = {
				set_temp_variable = { operation_id = v }
				set_temp_variable = { amount = 3 }
				has_amount_of_war_room_operation_used_generals = yes
				has_amount_of_war_room_operation_assigned_generals = yes
			}
			active_operation_assigned_general_4_bg_visible = {
				set_temp_variable = { operation_id = v }
				set_temp_variable = { amount = 4 }
				if = {
					limit = {
						has_amount_of_war_room_operation_used_generals = yes
						has_amount_of_war_room_operation_assigned_generals = yes
					}
					set_temp_variable = { active_operation_assigned_general_1_bg_frame = 2 }
				}
				else = {
					set_temp_variable = { active_operation_assigned_general_1_bg_frame = 1 }
				}
			}
			active_operation_assigned_general_4_name_visible = {
				set_temp_variable = { operation_id = v }
				set_temp_variable = { amount = 4 }
				OR = {
					has_less_amount_of_war_room_operation_used_generals = yes
					has_less_amount_of_war_room_operation_assigned_generals = yes
				}
			}
			active_operation_assigned_general_4_name_red_visible = {
				set_temp_variable = { operation_id = v }
				set_temp_variable = { amount = 4 }
				has_amount_of_war_room_operation_used_generals = yes
				has_amount_of_war_room_operation_assigned_generals = yes
			}
			## tabs
			active_operation_tab_button_description_visible = {
				set_temp_variable = { operation_id = v }
				has_war_room_operation_selected_decisions_tab = yes
			}
			active_operation_tab_icon_description_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_selected_decisions_tab = yes }
			}
			active_operation_tab_button_decisions_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_selected_decisions_tab = yes }
			}
			active_operation_tab_icon_decisions_visible = {
				set_temp_variable = { operation_id = v }
				has_war_room_operation_selected_decisions_tab = yes
			}
			## desc
			active_operation_desc_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_selected_decisions_tab = yes }
			}
			## decisions
			active_operation_get_decisions_visible = {
				clear_temp_array = active_operation_decisions_array_temp
				clear_temp_array = active_operation_decisions_array_active_temp
				clear_temp_array = active_operation_decisions_array_completed_temp
				clear_temp_array = active_operation_decisions_array_visible_temp
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				meta_trigger = {
					text = {
						all_of = {
							array = global.war_room_operation_[ID]_decisions_array
							value = value_temp
							index = index_temp
							set_temp_variable = { decision_id = value_temp }
							if = {
								limit = {
									is_war_room_operation_decision_in_progress = yes
								}
								add_to_temp_array = { active_operation_decisions_array_active_temp = decision_id }
							}
							else_if = {
								limit = {
									is_war_room_operation_decision_completed = yes
								}
								add_to_temp_array = { active_operation_decisions_array_completed_temp = decision_id }
							}
							else_if = {
								limit = {
									is_war_room_operation_decision_visible = yes
								}
								add_to_temp_array = { active_operation_decisions_array_visible_temp = decision_id }
							}
						}
					}
					ID = "[?operation_id]"
				}
				if = {
					limit = {
						check_variable = { active_operation_decisions_array_active_temp^num > 0 }
					}
					all_of = {
						array = active_operation_decisions_array_active_temp
						value = value_temp
						index = index_temp
						add_to_temp_array = { active_operation_decisions_array_temp = value_temp }
					}
				}
				if = {
					limit = {
						check_variable = { active_operation_decisions_array_visible_temp^num > 0 }
					}
					all_of = {
						array = active_operation_decisions_array_visible_temp
						value = value_temp
						index = index_temp
						add_to_temp_array = { active_operation_decisions_array_temp = value_temp }
					}
				}
				if = {
					limit = {
						check_variable = { active_operation_decisions_array_completed_temp^num > 0 }
					}
					all_of = {
						array = active_operation_decisions_array_completed_temp
						value = value_temp
						index = index_temp
						add_to_temp_array = { active_operation_decisions_array_temp = value_temp }
					}
				}
			}
			### individual decisions
			decision_get_remove_and_cancel_triggers_visible = {
				set_temp_variable = { operation_id = v }
				set_temp_variable = { decision_id = decision_v }
				is_war_room_operation_decision_removing = yes
				hidden_trigger = {
					always = no # just used for tooltips
				}
			}
			decision_get_remove_and_cancel_triggers_click_enabled = {
				set_temp_variable = { operation_id = v }
				set_temp_variable = { decision_id = decision_v }
				is_war_room_operation_decision_canceling = yes
			}
			decision_background_click_enabled = {
				set_temp_variable = { operation_id = v }
				set_temp_variable = { decision_id = decision_v }
				is_war_room_operation_decision_available = yes
				hidden_trigger = {
					can_afford_war_room_operation_decision_cost = yes
				}
			}
			decision_button_click_enabled = {
				set_temp_variable = { operation_id = v }
				set_temp_variable = { decision_id = decision_v }
				is_war_room_operation_decision_available = yes
				hidden_trigger = {
					can_afford_war_room_operation_decision_cost = yes
				}
			}
			decision_cost_icon_generals_visible = {
				set_temp_variable = { cost_icon_y = 0 }
				set_temp_variable = { operation_id = v }
				set_temp_variable = { decision_id = decision_v }
				calculate_war_room_operation_decision_cost = yes
				check_variable = { generals_cost > 0 }
				if = {
					limit = {
						check_variable = { cp_cost = 0 }
					}
					set_temp_variable = { cost_icon_y = 8 }
				}
			}
			decision_cost_value_generals_visible = {
				set_temp_variable = { operation_id = v }
				set_temp_variable = { decision_id = decision_v }
				calculate_war_room_operation_decision_cost = yes
				check_variable = { generals_cost > 0 }
			}
			decision_cost_icon_command_power_visible = {
				set_temp_variable = { operation_id = v }
				set_temp_variable = { decision_id = decision_v }
				calculate_war_room_operation_decision_cost = yes
				check_variable = { cp_cost > 0 }
				if = {
					limit = {
						check_variable = { generals_cost = 0 }
					}
					set_temp_variable = { cost_icon_y = -8 }
				}
			}
			decision_cost_value_command_power_visible = {
				set_temp_variable = { operation_id = v }
				set_temp_variable = { decision_id = decision_v }
				calculate_war_room_operation_decision_cost = yes
				check_variable = { cp_cost > 0 }
			}
			## info text
			active_operation_launched_info_text_title_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_launched_war_room_operation = yes
			}
			active_operation_launched_info_text_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_launched_war_room_operation = yes
			}
			## progressbar
			active_operation_progressbar_background_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
			}
			active_operation_progressbar_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
				set_temp_variable = { amount = 1 }
				has_amount_of_war_room_operation_progress = yes
			}
			active_operation_progressbar_frame_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
			}
			active_operation_progressbar_indicator_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
				calculate_war_room_operation_progress = yes
				set_temp_variable = { active_operation_progressbar_indicator_x = operation_progress }
				multiply_temp_variable = { active_operation_progressbar_indicator_x = 3.85 }
				round_temp_variable = active_operation_progressbar_indicator_x
			}
			active_operation_progressbar_indicator_text_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
			}
			active_operation_phase_icon_1_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
				has_war_room_operation_progress_phase_1 = yes
				NOT = { is_war_room_operation_progress_phase_1_active = yes }
			}
			active_operation_phase_icon_1_active_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
				is_war_room_operation_progress_phase_1_active = yes
			}
			active_operation_phase_text_1_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
				has_war_room_operation_progress_phase_1 = yes
				NOT = { is_war_room_operation_progress_phase_1_active = yes }
			}
			active_operation_phase_text_1_active_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
				is_war_room_operation_progress_phase_1_active = yes
			}
			active_operation_phase_icon_2_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
				has_war_room_operation_progress_phase_2 = yes
				NOT = { is_war_room_operation_progress_phase_2_active = yes }
			}
			active_operation_phase_icon_2_active_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
				is_war_room_operation_progress_phase_2_active = yes
			}
			active_operation_phase_text_2_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
				has_war_room_operation_progress_phase_2 = yes
				NOT = { is_war_room_operation_progress_phase_2_active = yes }
			}
			active_operation_phase_text_2_active_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
				is_war_room_operation_progress_phase_2_active = yes
			}
			active_operation_phase_icon_3_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
				has_war_room_operation_progress_phase_3 = yes
				NOT = { is_war_room_operation_progress_phase_3_active = yes }
			}
			active_operation_phase_icon_3_active_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
				is_war_room_operation_progress_phase_3_active = yes
			}
			active_operation_phase_text_3_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
				has_war_room_operation_progress_phase_3 = yes
				NOT = { is_war_room_operation_progress_phase_3_active = yes }
			}
			active_operation_phase_text_3_active_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
				is_war_room_operation_progress_phase_3_active = yes
			}
			active_operation_phase_icon_4_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
				has_war_room_operation_progress_phase_4 = yes
				NOT = { is_war_room_operation_progress_phase_4_active = yes }
			}
			active_operation_phase_icon_4_active_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
				is_war_room_operation_progress_phase_4_active = yes
			}
			active_operation_phase_text_4_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
				has_war_room_operation_progress_phase_4 = yes
				NOT = { is_war_room_operation_progress_phase_4_active = yes }
			}
			active_operation_phase_text_4_active_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
				is_war_room_operation_progress_phase_4_active = yes
			}
			active_operation_phase_icon_5_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
				has_war_room_operation_progress_phase_5 = yes
				NOT = { is_war_room_operation_progress_phase_5_active = yes }
			}
			active_operation_phase_icon_5_active_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
				is_war_room_operation_progress_phase_5_active = yes
			}
			active_operation_phase_text_5_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
				has_war_room_operation_progress_phase_5 = yes
				NOT = { is_war_room_operation_progress_phase_5_active = yes }
			}
			active_operation_phase_text_5_active_visible = {
				set_temp_variable = { operation_id = v }
				NOT = { has_war_room_operation_collapsed = yes }
				has_war_room_operation_selected_decisions_tab = yes
				has_not_launched_war_room_operation = yes
				is_war_room_operation_progress_phase_5_active = yes
			}
		}

		dynamic_lists = {
			war_room_possible_operations_gridbox = {
				array = possible_war_room_operations_array
				entry_container = war_room_possible_operations_entry
			}
			war_room_active_operations_gridbox = {
				array = active_war_room_operations_array
				entry_container = "[This.GetWarRoomActiveOperationEntryContainer]"
			}
			war_room_operations_decisions_gridbox = {
				array = active_operation_decisions_array_temp
				entry_container = "[This.GetWarRoomOperationDecisionEntryContainer]"
				value = decision_v
				index = decision_i
			}
		}

		properties = {
			# war room
			war_room_background = {
				image = "[This.GetWarRoomBackground]"
			}
			war_room_icon = {
				image = "[This.GetWarRoomIcon]"
			}
			# possible operations
			operation_icon = {
				frame = operation_icon_frame
			}
			# active operations
			active_operation_picture = {
				image = "GFX_war_room_operation_picture_[?v]"
			}
			active_operation_assign_general_button = {
				frame = active_operation_assign_general_button_frame
			}
			active_operation_assigned_general_1_bg = {
				frame = active_operation_assigned_general_1_bg_frame
			}
			active_operation_assigned_general_2_bg = {
				frame = active_operation_assigned_general_2_bg_frame
			}
			active_operation_assigned_general_3_bg = {
				frame = active_operation_assigned_general_3_bg_frame
			}
			active_operation_assigned_general_4_bg = {
				frame = active_operation_assigned_general_4_bg_frame
			}
			## decisions
			decision_icon = {
				image = "GFX_operation_decision_[?decision_v.GetTokenKey]"
			}
			decision_cost_icon_generals = {
				y = cost_icon_y
			}
			decision_cost_value_generals = {
				y = cost_icon_y
			}
			decision_cost_icon_command_power = {
				y = cost_icon_y
			}
			decision_cost_value_command_power = {
				y = cost_icon_y
			}
			## progressbars
			active_operation_progressbar_background = {
				image = "[This.GetWarRoomActiveOperationProgressBarBg]"
			}
			active_operation_progressbar = {
				image = "[This.GetWarRoomActiveOperationProgressBar]"
				frame = operation_progress
			}
			active_operation_progressbar_frame = {
				image = "[This.GetWarRoomActiveOperationProgressBarFrame]"
			}
			active_operation_progressbar_indicator = {
				image = "[This.GetWarRoomActiveOperationProgressBarIndicator]"
				x = active_operation_progressbar_indicator_x
			}
			active_operation_progressbar_indicator_text = {
				x = active_operation_progressbar_indicator_x
			}
			active_operation_phase_icon_1 = {
				image = "[This.GetWarRoomActiveOperationProgressBarPhaseIcon]"
				frame = 1
				x = active_operation_phase_1_x
			}
			active_operation_phase_icon_1_active = {
				image = "[This.GetWarRoomActiveOperationProgressBarPhaseIcon]"
				frame = 2
				x = active_operation_phase_1_x
			}
			active_operation_phase_text_1 = {
				x = active_operation_phase_1_x
			}
			active_operation_phase_text_1_active = {
				x = active_operation_phase_1_x
			}
			active_operation_phase_icon_2 = {
				image = "[This.GetWarRoomActiveOperationProgressBarPhaseIcon]"
				frame = 3
				x = active_operation_phase_2_x
			}
			active_operation_phase_icon_2_active = {
				image = "[This.GetWarRoomActiveOperationProgressBarPhaseIcon]"
				frame = 4
				x = active_operation_phase_2_x
			}
			active_operation_phase_text_2 = {
				x = active_operation_phase_2_x
			}
			active_operation_phase_text_2_active = {
				x = active_operation_phase_2_x
			}
			active_operation_phase_icon_3 = {
				image = "[This.GetWarRoomActiveOperationProgressBarPhaseIcon]"
				frame = 5
				x = active_operation_phase_3_x
			}
			active_operation_phase_icon_3_active = {
				image = "[This.GetWarRoomActiveOperationProgressBarPhaseIcon]"
				frame = 6
				x = active_operation_phase_3_x
			}
			active_operation_phase_text_3 = {
				x = active_operation_phase_3_x
			}
			active_operation_phase_text_3_active = {
				x = active_operation_phase_3_x
			}
			active_operation_phase_icon_4 = {
				image = "[This.GetWarRoomActiveOperationProgressBarPhaseIcon]"
				frame = 7
				x = active_operation_phase_4_x
			}
			active_operation_phase_icon_4_active = {
				image = "[This.GetWarRoomActiveOperationProgressBarPhaseIcon]"
				frame = 8
				x = active_operation_phase_4_x
			}
			active_operation_phase_text_4 = {
				x = active_operation_phase_4_x
			}
			active_operation_phase_text_4_active = {
				x = active_operation_phase_4_x
			}
			active_operation_phase_icon_5 = {
				image = "[This.GetWarRoomActiveOperationProgressBarPhaseIcon]"
				frame = 9
				x = active_operation_phase_5_x
			}
			active_operation_phase_icon_5_active = {
				image = "[This.GetWarRoomActiveOperationProgressBarPhaseIcon]"
				frame = 10
				x = active_operation_phase_5_x
			}
			active_operation_phase_text_5 = {
				x = active_operation_phase_5_x
			}
			active_operation_phase_text_5_active = {
				x = active_operation_phase_5_x
			}
		}

		ai_enabled = {
			always = no
		}
	}

	dh_war_room_assign_generals_window_panel = {
		context_type = player_context

		window_name = "dh_war_room_assign_generals_window_panel"
		parent_window_name = "dh_war_room_window"

		dirty = show_war_room_window

		visible = {
			has_variable = show_war_room_window
		}

		ai_enabled = {
			always = no
		}
	}

	dh_war_room_assign_generals_window = {
		context_type = player_context

		window_name = "dh_war_room_assign_generals_window"
		parent_window_name = "dh_war_room_assign_generals_window_panel_instance"

		dirty = show_war_room_window

		visible = {
			has_variable = show_dh_war_room_assign_generals_window
		}

		triggers = {
			assign_button_visible = {
				ROOT = {
					set_temp_variable = { operation_id = show_dh_war_room_assign_generals_window }
					has_active_war_room_operation = yes
				}
			}
			assign_button_click_enabled = {
				ROOT = {
					set_temp_variable = { operation_id = show_dh_war_room_assign_generals_window }
					has_not_launched_war_room_operation = yes
					set_temp_variable = { amount = 4 }
					has_less_amount_of_war_room_operation_assigned_generals = yes
				}
				set_temp_variable = { general_id = v }
				ROOT = {
					is_not_general_assigned_to_any_war_room_operation = yes
				}
			}
		}

		effects = {
			close_button_click = {
				clear_variable = show_dh_war_room_assign_generals_window
				update_war_room_window = yes
			}
			assign_button_click = {
				ROOT = {
					set_temp_variable = { operation_id = show_dh_war_room_assign_generals_window }
					set_temp_variable = { general_id = PREV.id }
					assign_general_to_war_room_operation = yes
					clear_variable = show_dh_war_room_assign_generals_window
					update_war_room_window = yes
				}
			}
		}

		dynamic_lists = {
			war_room_operations_assign_general_gridbox = {
				array = army_leaders
				entry_container = war_room_operations_assign_general_entry
				change_scope = yes
			}
		}

		ai_enabled = {
			always = no
		}
	}

	dh_war_room_operations_completed_popup_window = {
		context_type = player_context

		window_name = "dh_war_room_operations_completed_popup_window"

		dirty = war_room_operations_popup_completed_array^num

		visible = {
			is_ai = no
			check_variable = { war_room_operations_popup_completed_array^num > 0 }
		}

		effects = {
			entry_close_button_click = {
				set_temp_variable = { operation_id = v }
				remove_from_array = { war_room_operations_popup_completed_array = operation_id }
				custom_effect_tooltip = DH_WAR_ROOM_OPERATION_POPUP_ENTRY_EFFECTS_TT_COMPLETED
				meta_effect = {
					text = {
						effect_tooltip = {
							complete_war_room_operation_[ID] = yes
						}
					}
					ID = "[?operation_id]"
				}
			}
		}

		properties = {
			operation_picture = {
				image = "GFX_war_room_operation_picture_[?v]"
			}
			operation_stamp_icon = {
				frame = 1
			}
		}

		dynamic_lists = {
			war_room_operations_popup_completed_gridbox = {
				array = war_room_operations_popup_completed_array
				entry_container = war_room_operations_popup_entry
			}
		}

		ai_enabled = {
			always = no
		}
	}

	dh_war_room_operations_failed_popup_window = {
		context_type = player_context

		window_name = "dh_war_room_operations_failed_popup_window"

		dirty = war_room_operations_popup_failed_array^num

		visible = {
			is_ai = no
			check_variable = { war_room_operations_popup_failed_array^num > 0 }
		}

		effects = {
			entry_close_button_click = {
				set_temp_variable = { operation_id = v }
				remove_from_array = { war_room_operations_popup_failed_array = operation_id }
				custom_effect_tooltip = DH_WAR_ROOM_OPERATION_POPUP_ENTRY_EFFECTS_TT_FAILED
				meta_effect = {
					text = {
						effect_tooltip = {
							fail_war_room_operation_[ID] = yes
						}
					}
					ID = "[?operation_id]"
				}
			}
		}

		properties = {
			operation_picture = {
				image = "GFX_war_room_operation_picture_[?v]"
			}
			operation_stamp_icon = {
				frame = 2
			}
		}

		dynamic_lists = {
			war_room_operations_popup_failed_gridbox = {
				array = war_room_operations_popup_failed_array
				entry_container = war_room_operations_popup_entry
			}
		}

		ai_enabled = {
			always = no
		}
	}

	dh_war_room_operations_new_popup_window = {
		context_type = player_context

		window_name = "dh_war_room_operations_new_popup_window"

		dirty = war_room_operations_popup_new_array^num

		visible = {
			is_ai = no
			check_variable = { war_room_operations_popup_new_array^num > 0 }
		}

		effects = {
			entry_close_button_click = {
				set_temp_variable = { operation_id = v }
				meta_effect = {
					text = {
						clear_variable = war_room_operation_[ID]_random_number
					}
					ID = "[?operation_id]"
				}
				remove_from_array = { war_room_operations_popup_new_array = operation_id }
				update_war_room_window = yes
			}
			entry_close_button_right_click = {
				set_temp_variable = { operation_id = v }
				meta_effect = {
					text = {
						clear_variable = war_room_operation_[ID]_random_number
					}
					ID = "[?operation_id]"
				}
				remove_from_array = { war_room_operations_popup_new_array = operation_id }
				if = {
					limit = {
						has_variable = show_war_room_window
					}
					update_war_room_window = yes
				}
				else = {
					set_variable = { show_war_room_window = 1 }
				}
			}
		}

		triggers = {
			operation_name_visible = {
				set_temp_variable = { operation_id = v }
				meta_trigger = {
					text = {
						set_temp_variable = { random_temp_number = war_room_operation_[ID]_random_number }
					}
					ID = "[?operation_id]"
				}
			}
		}

		properties = {
			operation_picture = {
				image = "GFX_war_room_operation_picture_[?v]"
			}
		}

		dynamic_lists = {
			war_room_operations_popup_new_gridbox = {
				array = war_room_operations_popup_new_array
				entry_container = war_room_operations_popup_new_entry
			}
		}

		ai_enabled = {
			always = no
		}
	}
}